<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯è‹“è¡¨å–®é–‹ç«‹å¼µæ•¸çµ±è¨ˆåˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .stat-card .label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .stat-card .value {
            color: #333;
            font-size: 2.5em;
            font-weight: bold;
        }

        .stat-card .unit {
            color: #999;
            font-size: 0.8em;
        }

        .stat-card.highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card.highlight .label,
        .stat-card.highlight .value,
        .stat-card.highlight .unit {
            color: white;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-container h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .chart-wrapper.small {
            height: 300px;
        }

        .chart-wrapper.large {
            height: 500px;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        table td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        table tr:hover {
            background: #f5f5f5;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            background: #667eea;
            color: white;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .stat-card .value {
                font-size: 2em;
            }
        }

        .insight-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .insight-box h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .insight-box ul {
            margin-left: 20px;
            color: #856404;
        }

        .insight-box li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š è¯è‹“è¡¨å–®é–‹ç«‹å¼µæ•¸çµ±è¨ˆåˆ†æ</h1>
            <div class="subtitle">çµ±è¨ˆæœŸé–“: 2024å¹´11æœˆ - 2025å¹´11æœˆ</div>
        </div>

        <!-- é—œéµæŒ‡æ¨™ -->
        <div class="stats-grid">
            <div class="stat-card highlight">
                <div class="label">ä¸Šæœˆç¸½æµé‡ (2025å¹´11æœˆ)</div>
                <div class="value" id="lastMonthTotal">-</div>
                <div class="unit">ç­†</div>
            </div>
            <div class="stat-card">
                <div class="label">13å€‹æœˆç¸½æµé‡</div>
                <div class="value" id="totalForms">-</div>
                <div class="unit">ç­†</div>
            </div>
            <div class="stat-card">
                <div class="label">è¡¨å–®ç¨®é¡</div>
                <div class="value" id="formTypes">-</div>
                <div class="unit">ç¨®</div>
            </div>
            <div class="stat-card">
                <div class="label">æœˆå¹³å‡æµé‡</div>
                <div class="value" id="avgMonthly">-</div>
                <div class="unit">ç­†</div>
            </div>
        </div>

        <!-- é—œéµç™¼ç¾ -->
        <div class="chart-container">
            <h2>ğŸ” é—œéµç™¼ç¾èˆ‡æ´å¯Ÿ</h2>
            <div class="insight-box">
                <h3>çµ±è¨ˆæ‘˜è¦</h3>
                <ul id="insights">
                    <li>è¼‰å…¥ä¸­...</li>
                </ul>
            </div>
        </div>

        <!-- æœˆåº¦è¶¨å‹¢ -->
        <div class="chart-container">
            <h2>ğŸ“ˆ æœˆåº¦æµé‡è¶¨å‹¢</h2>
            <div class="chart-wrapper large">
                <canvas id="monthlyTrendChart"></canvas>
            </div>
        </div>

        <!-- é¡åˆ¥åˆ†å¸ƒ -->
        <div class="two-column">
            <div class="chart-container">
                <h2>ğŸ“Š è¡¨å–®é¡åˆ¥åˆ†å¸ƒ</h2>
                <div class="chart-wrapper">
                    <canvas id="categoryPieChart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h2>ğŸ† å„é¡åˆ¥æµé‡çµ±è¨ˆ</h2>
                <div class="chart-wrapper">
                    <canvas id="categoryBarChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ç†±é–€è¡¨å–® -->
        <div class="chart-container">
            <h2>ğŸ”¥ ç†±é–€è¡¨å–® TOP 10</h2>
            <div class="chart-wrapper large">
                <canvas id="topFormsChart"></canvas>
            </div>
        </div>

        <!-- é¡åˆ¥æœˆåº¦è¶¨å‹¢ -->
        <div class="chart-container">
            <h2>ğŸ“‰ å„é¡åˆ¥æœˆåº¦è¶¨å‹¢</h2>
            <div class="chart-wrapper large">
                <canvas id="categoryTrendChart"></canvas>
            </div>
        </div>

        <!-- è©³ç´°è¡¨å–®çµ±è¨ˆ -->
        <div class="chart-container">
            <h2>ğŸ“‹ è©³ç´°è¡¨å–®çµ±è¨ˆ</h2>
            <div class="table-container">
                <table id="detailTable">
                    <thead>
                        <tr>
                            <th>æ’å</th>
                            <th>é¡åˆ¥</th>
                            <th>è¡¨å–®åç¨±</th>
                            <th>ç¸½è¨ˆ</th>
                            <th>æœˆå¹³å‡</th>
                            <th>ä¸Šæœˆæµé‡</th>
                            <th>è¶¨å‹¢</th>
                        </tr>
                    </thead>
                    <tbody id="detailTableBody">
                        <tr><td colspan="7">è¼‰å…¥ä¸­...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            <p>Â© 2025 è¯è‹“è¡¨å–®çµ±è¨ˆç³»çµ± | æ•¸æ“šæ›´æ–°æ™‚é–“: <span id="updateTime"></span></p>
        </div>
    </div>

    <script>
        // å¾JSONè¼‰å…¥è³‡æ–™
        const formData = {"months": ["202411", "202412", "202501", "202502", "202503", "202504", "202505", "202506", "202507", "202508", "202509", "202510", "202511"], "data": [{"category": "äººäº‹é¡", "name": "äººå“¡è³‡æ–™æ›´æ–°ç”³è«‹å–®", "monthly_data": [3, 1, 1, 0, 4, 0, 0, 0, 27, 0, 1, 2, 1], "total": 40}, {"category": "äººäº‹é¡", "name": "äººå“¡éœ€æ±‚ç”³è«‹è¡¨", "monthly_data": [7, 5, 18, 12, 7, 8, 19, 11, 11, 5, 4, 11, 8], "total": 126}, {"category": "äººäº‹é¡", "name": "å…§éƒ¨/å¤–éƒ¨è¨“ç·´ç”³è«‹è¡¨", "monthly_data": [5, 0, 4, 5, 5, 9, 7, 13, 11, 5, 10, 10, 2], "total": 86}, {"category": "äººäº‹é¡", "name": "æ—¥å¸¸ç¸¾æ•ˆè¡¨ç¾ç´€éŒ„è¡¨", "monthly_data": [0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1], "total": 8}, {"category": "äººäº‹é¡", "name": "å‡ºå·®ç”³è«‹å–®", "monthly_data": [6, 15, 5, 12, 17, 11, 21, 11, 5, 7, 21, 12, 9], "total": 152}, {"category": "äººäº‹é¡", "name": "åŠ ç­å–®", "monthly_data": [1340, 1437, 1094, 1137, 1168, 1112, 1093, 1163, 1175, 1154, 1137, 1122, 1006], "total": 15138}, {"category": "äººäº‹é¡", "name": "ç•°å‹•/é›¢è·æœƒè¾¦å–®", "monthly_data": [15, 35, 11, 18, 30, 10, 12, 20, 26, 12, 13, 16, 8], "total": 226}, {"category": "äººäº‹é¡", "name": "æ–°é€²å“¡å·¥è€ƒæ ¸è¡¨", "monthly_data": [5, 13, 2, 4, 3, 7, 12, 10, 10, 8, 15, 5, 13], "total": 107}, {"category": "äººäº‹é¡", "name": "åœ˜é«”åŠ ç­å–®", "monthly_data": [1721, 1620, 1498, 1516, 1772, 1744, 1623, 1592, 1723, 1591, 1497, 1500, 1590], "total": 20987}, {"category": "äººäº‹é¡", "name": "è«‹å‡å–®", "monthly_data": [1894, 2371, 1848, 2228, 1922, 1954, 1880, 2020, 2194, 1857, 1841, 1767, 1726], "total": 25502}, {"category": "äººäº‹é¡", "name": "éŠ·å‡å–®", "monthly_data": [47, 50, 21, 42, 43, 51, 59, 35, 57, 44, 47, 50, 42], "total": 588}, {"category": "äººäº‹é¡", "name": "ç¸¾æ•ˆè€ƒæ ¸æµç¨‹", "monthly_data": [0, 934, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], "total": 936}, {"category": "å…¬æ–‡é¡", "name": "ç°½å‘ˆç”³è«‹å–®", "monthly_data": [107, 112, 83, 78, 73, 81, 65, 90, 121, 61, 68, 90, 107], "total": 1136}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "ä¸€èˆ¬è²»ç”¨é»è²¼å–®", "monthly_data": [1377, 1348, 1040, 1205, 1247, 1198, 1280, 1217, 1323, 1227, 1260, 1231, 1303], "total": 16256}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "å·¥å» åƒè¨ªç”³è«‹å–®", "monthly_data": [2, 2, 0, 1, 5, 4, 3, 4, 2, 2, 1, 4, 6], "total": 36}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "å…§æ¹–åœ˜è†³ç”³è«‹å–®", "monthly_data": [103, 132, 81, 107, 127, 117, 124, 122, 160, 129, 153, 144, 139], "total": 1638}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "å¤–å¹£_æš«å€Ÿæ¬¾ç”³è«‹å–®", "monthly_data": [27, 29, 25, 28, 33, 32, 26, 22, 36, 20, 25, 31, 20], "total": 354}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "è²»ç”¨å ±éŠ·å–®", "monthly_data": [0, 4, 3, 6, 3, 6, 3, 2, 6, 7, 7, 2, 0], "total": 49}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "è³‡è¨Šæœå‹™ç”³è«‹å–®", "monthly_data": [124, 117, 74, 125, 284, 177, 143, 147, 135, 90, 113, 104, 91], "total": 1724}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "å°å¤–äº¤éš›è²»ç”³è«‹å–®", "monthly_data": [15, 9, 9, 5, 12, 9, 11, 7, 9, 11, 12, 13, 16], "total": 138}, {"category": "ä¼æ¥­å…§éƒ¨ç”³è«‹å–®", "name": "æš«å€Ÿæ¬¾ç”³è«‹å–®", "monthly_data": [250, 248, 222, 234, 243, 267, 276, 275, 284, 262, 244, 257, 237], "total": 3299}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "å¤–éŠ·å®¢æˆ¶åŸºæœ¬è³‡æ–™è¡¨", "monthly_data": [4, 1, 1, 2, 1, 1, 2, 2, 1, 0, 2, 0, 0], "total": 17}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "å®¢æˆ¶ä¾›æ‡‰å•†æ–°å¢ç”³è«‹å–®", "monthly_data": [235, 230, 173, 252, 265, 312, 357, 348, 362, 290, 309, 273, 222], "total": 3628}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "å®¢æˆ¶ç§»è½‰ç”³è«‹å–®", "monthly_data": [2, 0, 0, 0, 4, 3, 0, 0, 2, 1, 1, 1, 2], "total": 16}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "å®¢æˆ¶è³‡æ–™ç•°å‹•å–®", "monthly_data": [361, 466, 343, 333, 391, 378, 343, 400, 440, 401, 358, 307, 280], "total": 4801}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "å®¢è¨´æŠ±æ€¨è™•ç†å–®", "monthly_data": [7, 10, 5, 11, 10, 8, 5, 7, 5, 5, 12, 13, 7], "total": 105}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "å®¢è¨´çŸ¯æ­£é é˜²æªæ–½è¿½è¹¤å–®", "monthly_data": [2, 1, 2, 0, 2, 0, 3, 1, 3, 0, 1, 3, 1], "total": 19}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "ç”¢å“ç¦ç”¨ç‰©è³ª_å¯©æŸ¥ç”³è«‹è¡¨", "monthly_data": [0, 0, 0, 0, 0, 0, 0, 0, 27, 20, 24, 23, 23], "total": 117}, {"category": "å®¢æˆ¶é—œä¿‚ç®¡ç†", "name": "è¬æ´²å®¢æˆ¶åŠæˆä¿¡é¡åº¦ç”³è«‹å–®", "monthly_data": [8, 6, 4, 3, 8, 8, 5, 7, 7, 8, 8, 8, 11], "total": 91}, {"category": "ç ”ç™¼é¡", "name": "ä¸Šè† åŠè£½ç¨‹è©¦æ©Ÿç”³è«‹å–®", "monthly_data": [17, 9, 19, 24, 10, 33, 26, 21, 35, 30, 15, 34, 12], "total": 285}, {"category": "ç ”ç™¼é¡", "name": "ç ”ç™¼å‚™å¿˜éŒ„", "monthly_data": [2, 2, 1, 10, 9, 10, 22, 16, 4, 9, 16, 8, 3], "total": 112}, {"category": "ç ”ç™¼é¡", "name": "é…æ–¹å–®_ç°½æ ¸", "monthly_data": [1, 0, 2, 10, 4, 7, 4, 2, 4, 4, 2, 1, 2], "total": 43}, {"category": "ç ”ç™¼é¡", "name": "è¬æ´²æ–°ç”¢å“é–‹ç™¼ç”³è«‹å–®", "monthly_data": [3, 0, 1, 1, 7, 0, 0, 6, 1, 0, 0, 1, 0], "total": 20}, {"category": "ç ”ç™¼é¡", "name": "è¬æ´²è£½ç¨‹è®Šæ›´ç”³è«‹å–®", "monthly_data": [0, 1, 0, 2, 0, 1, 3, 3, 3, 2, 0, 0, 1], "total": 16}, {"category": "ç ”ç™¼é¡", "name": "å¯¦é©—ç´€éŒ„ç°¿_ç°½æ ¸å–®", "monthly_data": [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3], "total": 39}, {"category": "ç ”ç™¼é¡", "name": "è£½è† è©¦æ©Ÿç”³è«‹å–®", "monthly_data": [1, 1, 6, 4, 2, 3, 2, 0, 2, 2, 0, 0, 2], "total": 25}, {"category": "è³‡æç§Ÿå€Ÿç®¡ç†", "name": "è³‡æç§Ÿå€Ÿç”³è«‹å–®", "monthly_data": [0, 108, 288, 364, 394, 311, 390, 349, 395, 388, 455, 355, 382], "total": 4179}, {"category": "è³‡æé¡", "name": "è¨‚è³¼é€šçŸ¥å–®_ç°½æ ¸", "monthly_data": [615, 604, 516, 520, 652, 554, 528, 489, 627, 531, 593, 553, 729], "total": 7511}, {"category": "è³‡æé¡", "name": "æ¡è³¼_è­°æ¯”åƒ¹ç”³è«‹å–®", "monthly_data": [102, 85, 56, 55, 96, 86, 82, 78, 82, 87, 82, 72, 92], "total": 1055}, {"category": "è³‡æé¡", "name": "è³‡æœ¬æ”¯å‡º_é©—æ”¶å ±å‘Šå–®", "monthly_data": [75, 67, 39, 35, 57, 48, 52, 51, 65, 43, 56, 60, 47], "total": 695}, {"category": "è³‡æé¡", "name": "è³‡æœ¬æ”¯å‡ºç”³è«‹å–®", "monthly_data": [51, 49, 27, 38, 58, 50, 49, 42, 66, 38, 68, 55, 33], "total": 624}, {"category": "è³‡æé¡", "name": "è³‡æœ¬æ”¯å‡º-è­°æ¯”åƒ¹å‘ˆæ ¸å–®", "monthly_data": [61, 33, 18, 44, 42, 45, 37, 37, 49, 31, 53, 49, 28], "total": 527}, {"category": "è³‡æé¡", "name": "è«‹è³¼(ä¿®)ç”³è«‹å–®", "monthly_data": [469, 417, 396, 416, 493, 444, 466, 513, 593, 495, 536, 506, 444], "total": 6188}]};

        // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
        function calculateStats() {
            const months = formData.months;
            const data = formData.data;

            // ç¸½æµé‡
            const totalForms = data.reduce((sum, item) => sum + item.total, 0);
            
            // ä¸Šæœˆæµé‡ (æœ€å¾Œä¸€å€‹æœˆ)
            const lastMonthIdx = months.length - 1;
            const lastMonthTotal = data.reduce((sum, item) => sum + item.monthly_data[lastMonthIdx], 0);
            
            // æœˆå¹³å‡
            const avgMonthly = Math.round(totalForms / months.length);
            
            // è¡¨å–®ç¨®é¡
            const formTypes = data.length;

            // å„é¡åˆ¥çµ±è¨ˆ
            const categoryStats = {};
            data.forEach(item => {
                if (!categoryStats[item.category]) {
                    categoryStats[item.category] = {
                        total: 0,
                        forms: [],
                        monthly: Array(months.length).fill(0)
                    };
                }
                categoryStats[item.category].total += item.total;
                categoryStats[item.category].forms.push(item.name);
                item.monthly_data.forEach((val, idx) => {
                    categoryStats[item.category].monthly[idx] += val;
                });
            });

            // ç†±é–€è¡¨å–®
            const topForms = [...data].sort((a, b) => b.total - a.total).slice(0, 10);

            return {
                totalForms,
                lastMonthTotal,
                avgMonthly,
                formTypes,
                categoryStats,
                topForms,
                months,
                data
            };
        }

        // æ›´æ–°é—œéµæŒ‡æ¨™
        function updateKeyMetrics(stats) {
            document.getElementById('lastMonthTotal').textContent = stats.lastMonthTotal.toLocaleString();
            document.getElementById('totalForms').textContent = stats.totalForms.toLocaleString();
            document.getElementById('formTypes').textContent = stats.formTypes;
            document.getElementById('avgMonthly').textContent = stats.avgMonthly.toLocaleString();
        }

        // ç”Ÿæˆé—œéµç™¼ç¾
        function generateInsights(stats) {
            const insights = [];
            
            insights.push(`ä¸Šæœˆ(2025å¹´11æœˆ)EIPé›»å­ç°½æ ¸è¡¨å–®æµé‡ç‚º <strong>${stats.lastMonthTotal.toLocaleString()}</strong> ç­†`);
            
            // æ‰¾å‡ºä¸Šæœˆæµé‡æœ€å¤§çš„é¡åˆ¥
            const lastMonthCategories = {};
            stats.data.forEach(item => {
                if (!lastMonthCategories[item.category]) {
                    lastMonthCategories[item.category] = 0;
                }
                lastMonthCategories[item.category] += item.monthly_data[stats.months.length - 1];
            });
            const topCategory = Object.entries(lastMonthCategories).sort((a, b) => b[1] - a[1])[0];
            insights.push(`ä¸Šæœˆæµé‡æœ€å¤§çš„é¡åˆ¥ç‚º <strong>${topCategory[0]}</strong>,å…± <strong>${topCategory[1].toLocaleString()}</strong> ç­†`);
            
            // ç†±é–€è¡¨å–®
            insights.push(`13å€‹æœˆæœŸé–“,æµé‡æœ€å¤§çš„è¡¨å–®ç‚º <strong>${stats.topForms[0].name}</strong>,ç¸½è¨ˆ <strong>${stats.topForms[0].total.toLocaleString()}</strong> ç­†`);
            
            // é¡åˆ¥çµ±è¨ˆ
            const categories = Object.entries(stats.categoryStats).sort((a, b) => b[1].total - a[1].total);
            insights.push(`æœ€æ´»èºçš„é¡åˆ¥ç‚º <strong>${categories[0][0]}</strong>,ä½”ç¸½æµé‡çš„ <strong>${((categories[0][1].total / stats.totalForms) * 100).toFixed(1)}%</strong>`);
            
            // æœˆå¹³å‡
            const monthlyTotals = Array(stats.months.length).fill(0);
            stats.data.forEach(item => {
                item.monthly_data.forEach((val, idx) => {
                    monthlyTotals[idx] += val;
                });
            });
            const maxMonth = Math.max(...monthlyTotals);
            const minMonth = Math.min(...monthlyTotals);
            const maxMonthIdx = monthlyTotals.indexOf(maxMonth);
            const minMonthIdx = monthlyTotals.indexOf(minMonth);
            insights.push(`æµé‡æœ€é«˜æœˆä»½ç‚º <strong>${stats.months[maxMonthIdx]}</strong> (${maxMonth.toLocaleString()}ç­†),æœ€ä½ç‚º <strong>${stats.months[minMonthIdx]}</strong> (${minMonth.toLocaleString()}ç­†)`);

            const insightsList = document.getElementById('insights');
            insightsList.innerHTML = insights.map(insight => `<li>${insight}</li>`).join('');
        }

        // å‰µå»ºæœˆåº¦è¶¨å‹¢åœ–
        function createMonthlyTrendChart(stats) {
            const ctx = document.getElementById('monthlyTrendChart').getContext('2d');
            
            // è¨ˆç®—æ¯æœˆç¸½æµé‡
            const monthlyTotals = Array(stats.months.length).fill(0);
            stats.data.forEach(item => {
                item.monthly_data.forEach((val, idx) => {
                    monthlyTotals[idx] += val;
                });
            });

            // æ ¼å¼åŒ–æœˆä»½æ¨™ç±¤
            const labels = stats.months.map(m => {
                const year = m.substring(0, 4);
                const month = m.substring(4, 6);
                return `${year}/${month}`;
            });

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ¯æœˆè¡¨å–®æµé‡',
                        data: monthlyTotals,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'æµé‡: ' + context.parsed.y.toLocaleString() + ' ç­†';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // å‰µå»ºé¡åˆ¥åœ“é¤…åœ–
        function createCategoryPieChart(stats) {
            const ctx = document.getElementById('categoryPieChart').getContext('2d');
            
            const categories = Object.entries(stats.categoryStats)
                .sort((a, b) => b[1].total - a[1].total);
            
            const colors = [
                'rgb(102, 126, 234)',
                'rgb(118, 75, 162)',
                'rgb(237, 100, 166)',
                'rgb(255, 154, 158)',
                'rgb(250, 208, 196)',
                'rgb(189, 224, 254)',
                'rgb(162, 210, 255)'
            ];

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories.map(c => c[0]),
                    datasets: [{
                        data: categories.map(c => c[1].total),
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value.toLocaleString()} ç­† (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // å‰µå»ºé¡åˆ¥æŸ±ç‹€åœ–
        function createCategoryBarChart(stats) {
            const ctx = document.getElementById('categoryBarChart').getContext('2d');
            
            const categories = Object.entries(stats.categoryStats)
                .sort((a, b) => b[1].total - a[1].total);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories.map(c => c[0]),
                    datasets: [{
                        label: 'æµé‡ (ç­†)',
                        data: categories.map(c => c[1].total),
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgb(102, 126, 234)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'æµé‡: ' + context.parsed.x.toLocaleString() + ' ç­†';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // å‰µå»ºç†±é–€è¡¨å–®åœ–è¡¨
        function createTopFormsChart(stats) {
            const ctx = document.getElementById('topFormsChart').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: stats.topForms.map(f => f.name),
                    datasets: [{
                        label: 'ç¸½æµé‡ (ç­†)',
                        data: stats.topForms.map(f => f.total),
                        backgroundColor: 'rgba(118, 75, 162, 0.8)',
                        borderColor: 'rgb(118, 75, 162)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ç¸½æµé‡: ' + context.parsed.y.toLocaleString() + ' ç­†';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // å‰µå»ºé¡åˆ¥è¶¨å‹¢åœ–
        function createCategoryTrendChart(stats) {
            const ctx = document.getElementById('categoryTrendChart').getContext('2d');
            
            const categories = Object.entries(stats.categoryStats)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 5); // åªé¡¯ç¤ºå‰5å€‹é¡åˆ¥

            const colors = [
                'rgb(102, 126, 234)',
                'rgb(118, 75, 162)',
                'rgb(237, 100, 166)',
                'rgb(255, 154, 158)',
                'rgb(189, 224, 254)'
            ];

            const labels = stats.months.map(m => {
                const year = m.substring(0, 4);
                const month = m.substring(4, 6);
                return `${year}/${month}`;
            });

            const datasets = categories.map((cat, idx) => ({
                label: cat[0],
                data: cat[1].monthly,
                borderColor: colors[idx],
                backgroundColor: colors[idx].replace('rgb', 'rgba').replace(')', ', 0.1)'),
                tension: 0.4,
                fill: false
            }));

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + ' ç­†';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // å‰µå»ºè©³ç´°è¡¨æ ¼
        function createDetailTable(stats) {
            const tbody = document.getElementById('detailTableBody');
            const sortedData = [...stats.data].sort((a, b) => b.total - a.total);

            const rows = sortedData.map((item, idx) => {
                const avg = Math.round(item.total / stats.months.length);
                const lastMonth = item.monthly_data[stats.months.length - 1];
                const prevMonth = item.monthly_data[stats.months.length - 2];
                
                let trend = 'â†’';
                let trendColor = '#666';
                if (lastMonth > prevMonth) {
                    trend = 'â†‘';
                    trendColor = '#28a745';
                } else if (lastMonth < prevMonth) {
                    trend = 'â†“';
                    trendColor = '#dc3545';
                }

                return `
                    <tr>
                        <td><span class="badge">${idx + 1}</span></td>
                        <td>${item.category}</td>
                        <td>${item.name}</td>
                        <td><strong>${item.total.toLocaleString()}</strong></td>
                        <td>${avg.toLocaleString()}</td>
                        <td>${lastMonth.toLocaleString()}</td>
                        <td style="color: ${trendColor}; font-size: 1.5em;">${trend}</td>
                    </tr>
                `;
            }).join('');

            tbody.innerHTML = rows;
        }

        // æ›´æ–°æ™‚é–“
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-TW', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('updateTime').textContent = timeStr;
        }

        // åˆå§‹åŒ–
        function init() {
            const stats = calculateStats();
            
            updateKeyMetrics(stats);
            generateInsights(stats);
            createMonthlyTrendChart(stats);
            createCategoryPieChart(stats);
            createCategoryBarChart(stats);
            createTopFormsChart(stats);
            createCategoryTrendChart(stats);
            createDetailTable(stats);
            updateTime();
        }

        // åŸ·è¡Œåˆå§‹åŒ–
        init();
    </script>
</body>
</html>
